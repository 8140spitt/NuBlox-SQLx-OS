# <img alt="NuBlox" width="360" src="data:image/svg+xml;utf8,<svg width='103' height='30' viewBox='0 0 103 30' fill='none' xmlns='http://www.w3.org/2000/svg'><path d='M1.26 13V0.76H4.302L9.018 7.402V0.76H12.294V13H9.234L4.536 6.556V13H1.26ZM21.2027 12.262C20.8307 12.466 20.3507 12.694 19.7627 12.946C19.1867 13.198 18.5327 13.324 17.8007 13.324C16.5647 13.324 15.6947 12.982 15.1907 12.298C14.6987 11.602 14.4527 10.732 14.4527 9.688V4.288H17.7287V9.616C17.7287 9.952 17.8127 10.21 17.9807 10.39C18.1607 10.57 18.4007 10.66 18.7007 10.66C18.8927 10.66 19.1327 10.606 19.4207 10.498C19.7087 10.39 19.9847 10.276 20.2487 10.156V4.288H23.5247V13H21.8867L21.2027 12.262ZM25.8694 13V0.76H29.9554C31.2994 0.76 32.4754 1.036 33.4834 1.588C34.4914 2.14 34.9954 3.04 34.9954 4.288V4.378C34.9834 4.81 34.8874 5.206 34.7074 5.566C34.5394 5.914 34.3174 6.226 34.0414 6.502C34.5214 6.838 34.9114 7.252 35.2114 7.744C35.5234 8.224 35.6794 8.758 35.6794 9.346C35.6794 10.75 35.1454 11.71 34.0774 12.226C33.0094 12.742 31.8154 13 30.4954 13H25.8694ZM29.8474 3.334H29.1454V5.404H29.8834C30.3874 5.404 30.8014 5.326 31.1254 5.17C31.4494 5.014 31.6114 4.774 31.6114 4.45C31.6114 4.078 31.4554 3.802 31.1434 3.622C30.8314 3.43 30.3994 3.334 29.8474 3.334ZM30.5314 7.978H29.1454V10.426H30.5674C31.0714 10.426 31.4854 10.33 31.8094 10.138C32.1334 9.946 32.2954 9.658 32.2954 9.274C32.2954 8.866 32.1394 8.548 31.8274 8.32C31.5154 8.092 31.0834 7.978 30.5314 7.978ZM37.2909 13V0.489999L40.5669 0.291999V13H37.2909ZM42.1826 8.59C42.1826 7.126 42.6626 5.992 43.6226 5.188C44.5946 4.372 45.7646 3.964 47.1326 3.964C48.5726 3.964 49.7546 4.36 50.6786 5.152C51.6146 5.944 52.0826 7.12 52.0826 8.68C52.0826 10.144 51.5966 11.266 50.6246 12.046C49.6526 12.814 48.4646 13.198 47.0606 13.198C45.6566 13.198 44.4926 12.82 43.5686 12.064C42.6446 11.308 42.1826 10.15 42.1826 8.59ZM45.5666 8.59C45.5666 9.178 45.6986 9.652 45.9626 10.012C46.2266 10.36 46.6046 10.534 47.0966 10.534C47.6126 10.534 48.0086 10.378 48.2846 10.066C48.5606 9.754 48.6986 9.292 48.6986 8.68C48.6986 8.092 48.5666 7.606 48.3026 7.222C48.0386 6.826 47.6606 6.628 47.1686 6.628C46.6526 6.628 46.2566 6.802 45.9806 7.15C45.7046 7.498 45.5666 7.978 45.5666 8.59ZM59.5229 13L57.9929 11.128L56.4989 13H52.8089L56.0129 8.662L52.8089 4.684L56.1929 4.234L57.8849 6.376L59.5769 4.27H63.1949L59.8649 8.842L63.1949 13H59.5229ZM64.9171 11.776C65.2291 11.932 65.6551 12.088 66.1951 12.244C66.7351 12.4 67.3051 12.478 67.9051 12.478C68.9371 12.478 69.7231 12.244 70.2631 11.776C70.8151 11.296 71.0911 10.744 71.0911 10.12C71.0911 8.8 69.9991 7.78 67.8151 7.06C65.6431 6.34 64.5571 5.11 64.5571 3.37C64.5571 2.542 64.8871 1.852 65.5471 1.3C66.2071 0.747999 67.1131 0.471999 68.2651 0.471999C68.8651 0.471999 69.4291 0.543999 69.9571 0.688C70.4851 0.831999 70.9291 0.993999 71.2891 1.174L70.8931 1.822C70.5811 1.678 70.2271 1.54 69.8311 1.408C69.4351 1.276 68.9251 1.21 68.3011 1.21C67.4371 1.21 66.7531 1.432 66.2491 1.876C65.7451 2.308 65.4931 2.836 65.4931 3.46C65.4931 4.828 66.5791 5.884 68.7511 6.628C70.9231 7.36 72.0091 8.542 72.0091 10.174C72.0091 11.074 71.6611 11.812 70.9651 12.388C70.2691 12.952 69.2551 13.234 67.9231 13.234C67.4071 13.234 66.7831 13.156 66.0511 13C65.3191 12.832 64.8511 12.658 64.6471 12.478L64.9171 11.776ZM79.3384 0.471999C81.1144 0.471999 82.3984 1.108 83.1904 2.38C83.9824 3.652 84.3784 5.122 84.3784 6.79C84.3784 7.69 84.2524 8.554 84.0004 9.382C83.7604 10.198 83.4004 10.906 82.9204 11.506L84.2524 12.802L83.6764 13.252L82.3984 12.064C81.9904 12.436 81.5224 12.73 80.9944 12.946C80.4664 13.15 79.8784 13.252 79.2304 13.252C77.4424 13.252 76.1524 12.616 75.3604 11.344C74.5684 10.06 74.1724 8.59 74.1724 6.934C74.1724 5.146 74.6164 3.622 75.5044 2.362C76.3924 1.102 77.6704 0.471999 79.3384 0.471999ZM75.1624 6.916C75.1624 8.38 75.4864 9.682 76.1344 10.822C76.7824 11.95 77.8024 12.514 79.1944 12.514C79.7104 12.514 80.1784 12.424 80.5984 12.244C81.0304 12.052 81.4144 11.788 81.7504 11.452L79.8424 9.652L80.4544 9.058L82.2724 10.858C82.6324 10.342 82.9084 9.736 83.1004 9.04C83.2924 8.344 83.3884 7.6 83.3884 6.808C83.3884 5.344 83.0644 4.048 82.4164 2.92C81.7804 1.792 80.7604 1.228 79.3564 1.228C78.0724 1.228 77.0524 1.786 76.2964 2.902C75.5404 4.006 75.1624 5.344 75.1624 6.916ZM94.0483 13H87.3703V0.76H88.2523V12.298H93.9583L94.0483 13ZM94.5921 13L97.8141 8.608L94.8441 4.45L95.7261 4.27L98.4981 8.194L101.27 4.27H102.242L98.9661 8.824L102.008 13H101.018L98.2641 9.274L95.6001 13H94.5921Z' fill='%23F4F4F5'/><rect y='17' width='25.75' height='3' fill='%23A65DE9'/><rect x='25.75' y='17' width='25.75' height='3' fill='%2347A4FF'/><rect x='51.5' y='17' width='25.75' height='3' fill='%2347FFD7'/><rect x='77.25' y='17' width='25.75' height='3' fill='%23FBA94C'/><path d='M3.96619 22.6894H2.26971V27.469H1.65V22.6894H0V22.2014H3.89647L3.96619 22.6894Z...' fill='%23F4F4F5'/></svg>" />

### NuBlox SQLx OS — Universal SQL, Learned at Runtime

**Version:** 2.0 (Draft for community review)
**Status:** Public preview (OSS core, enterprise add-ons)

---

## Table of Contents

1. Vision & Executive Summary
2. What SQLx OS Is (and Isn’t)
3. Design Principles
4. Architecture (Two-Layer View)
5. Feature Learning Runtime (FLR)
6. DML / DQL / TCL Advancements
7. CLI & Developer UX
8. Benchmarking & Total Cost of Ownership (TCO)
9. Security, Privacy, and Compliance
10. Observability & SLOs
11. Multi-Cloud, Hybrid, and Edge
12. Governance & Open Source
13. Monetization (How NuBlox Makes Money)
14. Enterprise Roadmap (Quarterly)
15. Implementation Guide (90 minutes to first value)
16. Glossary

---

## 1) Vision & Executive Summary

**NuBlox SQLx OS** is an open system that makes SQL **portable, adaptive, and testable** across engines (MySQL, Postgres first; others next). Where classic drivers “assume” capabilities, SQLx **learns them at runtime**—from auth plugins to TLS to limits, extensions, and wire idiosyncrasies—then shapes queries and behaviors accordingly.

### Why now

* Teams run multi-engine, multi-cloud. Switching or standardizing is costly.
* SQL dialect drift is real (functions, parameter rules, result shapes).
* Security, compliance, and SLOs are table stakes; *runtime discovery* reduces human error.

### What you get

* **Universal CLI & SDK**: `sqlx ping | learn | query | snapshot` that *adapts*.
* **Feature Learning Runtime (FLR)**: Probes wire-level behaviors, caches fingerprints, chooses best-fit paths (auth, params, paging, retries).
* **DML/DQL/TCL Enhancements**: Safer parameterization, transactional patterns, and optimizer-hints via portable hints.
* **Bench-ready**: Built-in benchmarking harness and cost models.
* **Enterprise-grade**: Secure defaults, observability hooks, policy gates.

---

## 2) What SQLx OS Is (and Isn’t)

**Is:**

* A minimal, fast, OSS runtime + CLI that learns a target database’s capabilities, then **normalizes** developer experience.
* A **thin transport** with **smart adapters**, not a heavy virtualization layer.

**Isn’t:**

* Not a SQL rewrite proxy that tries to support every function. We prefer **capability-aware fallbacks** and **explicit guardrails**.
* Not a closed shim. Core is MIT/Apache-2. Enterprise features are add-ons.

---

## 3) Design Principles

* **Learn → Adapt → Commit:** Discover before acting; pick the safest/fastest path.
* **Small surface, sharp edges:** Minimal APIs, predictable failure modes.
* **Local-first ergonomics:** No daemon required; works in CI, containers, edge.
* **Observability everywhere:** Structured events; reproducible traces.

---

## 4) Architecture (Two-Layer View)

### Layer A — Executive Summary (outcomes)

* **Portability:** One CLI/SDK across engines.
* **Reliability:** Auth/TLS/timeouts/retries chosen by runtime facts, not guesses.
* **Speed-to-value:** 90 minutes from clone → ping → learn → query on real data.
* **Compliance-ready:** Policy hooks (who can do what, where, when).
* **Cost-aware:** Built-in benchmark harness + cost estimators.

### Layer B — Technical (modules)

* **Transports:** `@nublox/sqlx-transport-mysql`, `@nublox/sqlx-transport-pg` (more coming).
* **Core:** `@nublox/sqlx-core` – types, param normalization, capability schema, telemetry hooks.
* **CLI:** `@nublox/sqlx-cli` – zero-friction operator and dev tool.
* **Feature Learning Runtime:** Probe → Fingerprint → Cache → Enforce decisions.
* **Policy & Observability bridges:** JSON policy, OpenTelemetry events.

---

## 5) Feature Learning Runtime (FLR)

**What it learns (non-exhaustive):**

* **Auth/TLS:** supported plugins, TLS on/off/require, server CA hints.
* **Protocol quirks:** handshake sizes, max packet, affected rows semantics.
* **SQL dialect hints:** parameter rules (`$1` vs `?`), statement class behaviors.
* **Extensions:** PG extensions, MySQL plugins/features (e.g., caching_sha2).
* **Operational limits:** max connections, statement_timeout, result paging.

**How it’s used:**

1. **`sqlx ping`**: no-auth capability probe, TLS and auth hints.
2. **`sqlx learn`**: authenticated check (`select version()`), confirm dialect features.
3. **Runtime decisions**: choose `normalizeParams`, TLS mode, retry budget, and paging strategy.
4. **Cache**: in-memory + optional file cache (`~/.sqlx/fingerprints.json`).
5. **Guardrails**: deny risky ops (DROP/ALTER) unless policy allows; enforce transaction “fences”.

---

## 6) DML / DQL / TCL Advancements

### DML (INSERT/UPDATE/DELETE)

* **Param Safety:** Engine-aware param normalization (`?` ↔ `$1`), escaping rules.
* **Bulk Patterns:** Batches with adaptive chunking based on max packet/portal size.

### DQL (SELECT)

* **Portable paging:** Chooses `LIMIT/OFFSET` vs cursor/portals dynamically.
* **Row-shape harmonization:** Consistent `rows[]`, `fields[]`, `rowCount`.

### TCL (Transactions)

* **Smart retries:** Only for idempotent/committed-safe steps.
* **Fences:** Policy gates for DDL/TCL in production contexts.
* **Timeout orchestration:** Align client timeout with server `statement_timeout`.

---

## 7) CLI & Developer UX

### Install (workspace / global)

```bash
pnpm -w install
pnpm -r build
pnpm -F @nublox/sqlx-cli exec node -v    # sanity check
```

### Commands

```bash
# Probe (no login): auth/TLS hints, dialect fingerprint
sqlx ping --url "mysql://host:3306/db?ssl=0"
sqlx ping --url "postgres://host:5432/db?sslmode=prefer"

# Learn (login + version check)
sqlx learn --url "mysql://user:pass@host/db?ssl=1"

# One-off query with params
sqlx query --url "postgres://..." --sql "SELECT * FROM t WHERE id = $1" --params "[42]"

# Snapshot minimal catalog (non-system)
sqlx snapshot:pull --url "mysql://..." --out catalog.json
```

**Programmatic (TypeScript)**

```ts
import { normalizeParams } from '@nublox/sqlx-core';
import * as Pg from '@nublox/sqlx-transport-pg';

const c = await Pg.connect("postgres://user:pass@host/db?sslmode=require");
const sql = normalizeParams("SELECT * FROM users WHERE id = ?", "pg", [123]);
const out = await c.query(sql);
await c.close();
```

---

## 8) Benchmarking & TCO

### What to benchmark

* **Ping-to-first-query** latency.
* **Throughput & p95/p99** across DML/DQL with realistic payloads.
* **Transaction retries** under fail injection.
* **Cost model:** cloud instance + storage IO + egress + operator time.

### Built-in harness (roadmap)

* `sqlx bench run --profile <small|medium|large>`
* Emits **cost-per-1000-queries** and **operator-hours saved** (via policy/learning).

---

## 9) Security, Privacy, Compliance

* **Secure by default:** TLS preferred, timeouts enabled, minimal scopes.
* **Secrets hygiene:** URIs, masks, and environment-variable first.
* **Policy hooks:** JSON policies (allow/deny lists, time windows, environments).
* **Audit trail:** CLI emits structured events; SDK exposes hooks for SIEM.
* **Compliance alignments:** SOC2-ready practices; assist with HIPAA/PCI zones via policy fences (no PII in logs, redaction).

---

## 10) Observability & SLOs

* **Signals:** connection, auth, query_start/finish, retries, errors.
* **OTel-ready:** map events to traces/spans; labels include `dialect`, `region`, `policy`.
* **Golden dashboards:** timeouts vs server timeouts, retry budget, p95.
* **Error taxonomy:** auth, TLS, network, syntax, policy_denied, timeout.

---

## 11) Multi-Cloud, Hybrid, Edge

* **No daemon, no kernel tricks:** runs anywhere Node runs.
* **Regional awareness:** policy gating by region/tenant.
* **Edge patterns:** read-mostly DQL with snapshot caching (roadmap).

---

## 12) Governance & Open Source

* **License:** Core under permissive license (MIT/Apache-2).
* **Contrib model:** small PRs; golden tests via Dockerized MySQL/PG in CI.
* **Backwards compatibility:** SemVer, changesets, deprecation guides.
* **Security disclosures:** private email, 90-day fix window.

---

## 13) Monetization — How NuBlox Makes Money

**Free forever (OSS):** transports, CLI, feature learning, basic policy & telemetry.

**Commercial add-ons:**

1. **NuBlox Control Plane (hosted or on-prem)**

   * Central policy, fingerprints cache, SBOM, fleet-wide config, RBAC/SAML.
   * Price: tiered per seat + per managed endpoint.

2. **Enterprise Connectors**

   * Additional engines (Oracle, SQL Server, Snowflake, BigQuery), HA patterns.
   * Price: per-connector subscription.

3. **Pro Observability Pack**

   * OTel enrichment, dashboards, SLO advisor, anomaly alerts.
   * Price: per active developer/cluster.

4. **Support & Compliance**

   * 24×7, long-term support branches, audit artifacts.
   * Price: tiered support contracts.

---

## 14) Enterprise Roadmap (Quarterly Highlights)

**Q1**

* Rich `ping` fingerprint (auth/TLS/limits/extensions).
* Bench harness v1; policy v1 (allow/deny, DDL/TCL fences).
* CI golden tests (dockerized MySQL/PG).

**Q2**

* Snapshot diff/compare; drift alerts.
* OTel exporter & dashboards v1.
* SSL matrices (require/verify-ca/verify-full) + cert pinning.

**Q3**

* Additional engines (SQL Server, SQLite) and cloud flavors (Aurora/RDS).
* Control Plane preview (central policy & fingerprints).
* Edge read caching (opt-in).

---

## 15) Implementation Guide — 90 Minutes to First Value

**0–15 min: Clone & Build**

```bash
git clone https://github.com/8140spitt/NuBlox-SQLx-OS
cd NuBlox-SQLx-OS
pnpm -w install && pnpm -r build
```

**15–30 min: Probe**

```bash
sqlx ping --url "mysql://host:3306/db?ssl=0"
sqlx ping --url "postgres://host:5432/db?sslmode=prefer"
```

**30–60 min: Learn & Query**

```bash
sqlx learn --url "postgres://user:pass@host/db?sslmode=require"
sqlx query --url "postgres://..." --sql "SELECT now()" --params "[]"
```

**60–90 min: Snapshot & Policy (opt-in)**

```bash
sqlx snapshot:pull --url "mysql://..." --out catalog.json
# (coming up) sqlx policy check --policy policy.json --url ...
```

---

## 16) Glossary

* **FLR:** Feature Learning Runtime (probe → fingerprint → cache → decide).
* **DDL/DML/DQL/TCL:** Schema / Write / Read / Transactional control.
* **Policy fence:** Guardrail preventing risky operations by context.
* **Fingerprints:** Learned capability records per endpoint.

---

### Appendix A — Example Policy (concept)

```json
{
  "environments": {
    "prod": {
      "deny": ["DDL", "DROP", "ALTER"],
      "tcl": { "requireTransaction": true, "maxDurationMs": 30000 },
      "query": { "statementTimeoutMs": 15000 }
    }
  },
  "telemetry": { "piiRedaction": true }
}
```

### Appendix B — Error Taxonomy (short list)

* `ERR_AUTH_UNSUPPORTED`, `ERR_TLS_REQUIRED`, `ERR_PARAM_MISMATCH`,
* `ERR_POLICY_DENIED`, `ERR_TIMEOUT_CLIENT`, `ERR_TIMEOUT_SERVER`.

---

## Final Notes

* **You own your data path.** SQLx OS is a thin, auditable layer.
* **Start small.** Add `sqlx ping/learn` to CI; use policy fences later.
* **Contribute.** File issues, PRs, or propose new dialect fingerprints.

*NuBlox SQLx OS — making SQL **adaptive** across the real world.*
